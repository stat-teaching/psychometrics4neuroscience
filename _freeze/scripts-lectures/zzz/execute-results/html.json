{
  "hash": "35149c25315aec6293af8190d6432b6a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Untitled\"\nformat: html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading the cleaned data version\ndat <- readRDS(here(\"data\", \"emoint.rds\"))\n```\n:::\n\n\n\n# EDA\n\nLet's compute some statistics at the participant level:\n\nOverall accuracy of the experiment:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchance_level <- 1 / length(unique(dat$response))\nchance_level\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1428571\n```\n\n\n:::\n\n```{.r .cell-code}\ndat |> \n    group_by(id) |> \n    summarise(acc = mean(acc),\n              n_trials = n()) |>\n    ggplot(aes(x = acc, y = id)) +\n    geom_point(aes(size = n_trials)) +\n    geom_vline(xintercept = chance_level, lwd = 1, lty = \"dashed\")\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\nAll the participants are clearly above the chance level. For each trial there was all the 7 options.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |> \n    filter(emotion_lbl != \"neutral\") |> \n    group_by(id, emotion_lbl) |> \n    summarise(acc = mean(acc),\n              n_trial = n()) |> \n    ggplot(aes(x = emotion_lbl, y = acc, fill = emotion_lbl)) +\n    geom_point(aes(size = n_trial), position = position_jitter(width = 0.3, seed = 2025), alpha = 0.5, show.legend = FALSE) +\n    geom_boxplot(show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |>\n    filter(emotion_lbl != \"neutral\") |>  \n    group_by(id, intensity) |> \n    summarise(acc = mean(acc)) |> \n    ggplot(aes(x = intensity, y = acc)) +\n    geom_point() +\n    geom_line(aes(group = id), alpha = 0.5) +\n    geom_boxplot(aes(group = intensity))\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nLet's see also the error pattern:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |> \n    group_by(emotion_lbl, response_lbl) |> \n    count() |> \n    group_by(emotion_lbl)  |> \n    mutate(tot = sum(n)) |> \n    ungroup() |> \n    mutate(p = n / tot) |> \n    mutate(is_correct = ifelse(emotion_lbl == response_lbl, 1, 0)) |> \n    ggplot(aes(x = response_lbl, fill = factor(is_correct), y = p)) +\n    geom_col(position = position_dodge(), show.legend = FALSE) +\n    facet_wrap(~emotion_lbl, scales = \"free_y\") +\n    theme(\n        axis.text.x = element_text(angle = 90)\n    ) +\n        ylim(c(0,1)) +\n        scale_fill_manual(values = c(scales::alpha(\"black\", 0.5), \"firebrick\"))\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nThis is the proportion of responses for each emotion label as a function of the intensity.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |> \n    filter(emotion_lbl != \"neutral\") |> \n    group_by(emotion_lbl, response_lbl, intensity) |> \n    count() |> \n    group_by(emotion_lbl, intensity) |> \n    mutate(tot = sum(n))  |> \n    ungroup() |> \n    mutate(p = n / tot) |> \n    mutate(is_correct = ifelse(emotion_lbl == response_lbl, 1, 0)) |> \n    ggplot(aes(x = intensity, y = p, color = response_lbl)) +\n    facet_wrap(~emotion_lbl) +\n    geom_line(aes(lty = factor(is_correct)), lwd = 1) +\n    scale_linetype_manual(values = c(\"dashed\", \"solid\"), guide = \"none\")\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\nHere I'm calculating a variability measure (Shannon Entropy) to capture the variability of responses for a specific intensity level for each emotion. Higher entropy means a more uncertain response.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nentropy <- function(p, relative = FALSE) {\n  p <- p[p > 0]  # Exclude zero probabilities to avoid log(0)\n  H <- -sum(p * log2(p))\n  \n  if (relative) {\n    H <- H / log2(length(p))\n  }\n  return(H)\n}\n\ndat |> \n    filter(emotion_lbl != \"neutral\") |> \n    group_by(emotion_lbl, response_lbl, intensity) |> \n    count() |> \n    group_by(emotion_lbl, intensity) |> \n    mutate(tot = sum(n))  |> \n    ungroup() |> \n    mutate(p = n / tot) |> \n    mutate(is_correct = ifelse(emotion_lbl == response_lbl, 1, 0)) |> \n    group_by(emotion_lbl, intensity) |> \n    summarise(entropy = entropy(p, relative = TRUE)) |> \n    ggplot(aes(x = intensity, y = entropy)) +\n    geom_line(aes(color = emotion_lbl), lwd = 1)\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_intersection <- function(y1, y2, x){\n    x[which.min(abs(y1 - y2))]\n}\n\nget_intersection_point <- function(data){\n    data <- data |> \n        select(intensity, response_lbl, p) |> \n        pivot_wider(names_from = response_lbl, values_from = p)\n    datat <- select(data, -intensity)\n    idx <- combn(1:ncol(datat), 2) # variables combination\n    datat <- mutate(datat, across(everything(), replace_na, 0)) # replace NA with 0\n    x <- unique(data$intensity)\n\n    res <- vector(mode = \"list\", length = ncol(idx))\n\n    for(i in 1:length(res)){\n        rc <- idx[, i]\n        ii <- get_intersection(datat[[rc[1]]], datat[[rc[2]]], x)\n        res[[i]] <- data.frame(intensity = ii, emo1 = names(datat)[rc[1]], emo2 = names(datat)[rc[2]])\n    }\n    do.call(rbind, res)\n}\n\nint_point <- dat |> \n    filter(emotion_lbl != \"neutral\") |> \n    group_by(emotion_lbl, response_lbl, intensity) |> \n    count() |> \n    group_by(emotion_lbl, intensity) |> \n    mutate(tot = sum(n))  |> \n    ungroup() |> \n    mutate(p = n / tot) |> \n    group_nest(emotion_lbl) |> \n    mutate(int_point = map(data, get_intersection_point))\n```\n:::\n\n\n\nWe can also visualize some identity-specific effect to see if the pattern is the same for each face.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |> \n    filter(emotion_lbl != \"neutral\") |> \n    group_by(face, emotion_lbl, response_lbl, intensity) |> \n    count() |> \n    group_by(emotion_lbl, intensity) |> \n    mutate(tot = sum(n)) |> \n    mutate(p = n/tot) |> \n    ggplot(aes(x = intensity, y = p, color = response_lbl)) +\n    geom_line() +\n    facet_grid(emotion_lbl~face, drop = TRUE)\n```\n\n::: {.cell-output-display}\n![](zzz_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "zzz_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}